{% extends "layout.html" %} {% block title %}Dasbor Admin{% endblock %} {% block
content %}
<div class="flex min-h-screen bg-gray-100">
  <!-- Sidebar -->
  <aside class="w-64 bg-gray-800 text-white p-6">
    <h2 class="text-2xl font-bold mb-8">Admin Panel</h2>
    <nav class="space-y-1">
      <a
        href="{{ url_for('admin_dashboard') }}"
        class="block py-2.5 px-4 rounded transition duration-200 {% if request.endpoint == 'admin_dashboard' %}bg-gray-900 text-white{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %}"
        >Kelola Buku</a
      >
      <!-- Contoh di dalam navigasi Anda -->
      <a
        href="{{ url_for('manage_users') }}"
        class="block py-2.5 px-4 rounded transition duration-200 {% if request.endpoint == 'manage_users' %}bg-gray-900 text-white{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %}"
      >
        Kelola Pengguna
      </a>
      <a
        href="{{ url_for('view_logs') }}"
        class="block py-2.5 px-4 rounded transition duration-200 {% if request.endpoint == 'view_logs' %}bg-gray-900 text-white{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %}"
      >
        Logs
      </a>

      <a
        href="{{ url_for('logout') }}"
        class="block py-2.5 px-4 rounded transition duration-200 text-gray-300 hover:bg-gray-700 hover:text-white"
        >Logout</a
      >
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-10">
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %} {% for category, message in messages %}
    <div
      class="p-4 mb-4 text-sm rounded-lg {% if category == 'danger' %} bg-red-100 text-red-700 {% elif category == 'success' %} bg-green-100 text-green-700 {% else %} bg-blue-100 text-blue-700 {% endif %}"
      role="alert"
    >
      {{ message }}
    </div>
    {% endfor %} {% endif %} {% endwith %}
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-3xl font-bold">Manajemen Buku</h1>
      <div class="flex flex-col items-end">
        <a
          href="{{ url_for('tambah_buku') }}"
          class="bg-green-500 text-white py-2 px-6 rounded-lg hover:bg-green-600 transition-colors"
        >
          + Tambah Buku
        </a>
        {% if current_user and current_user.otp_secret is none %}
        <a
          href="{{ url_for('setup_2fa') }}"
          class="mt-2 inline-block bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors"
        >
          Aktifkan 2FA
        </a>
        {% else %}
        <!-- Jika 2FA sudah aktif, tampilkan tombol untuk menonaktifkan -->
        <a
          href="{{ url_for('disable_2fa') }}"
          class="mt-2 inline-block bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors"
        >
          Nonaktifkan 2FA
        </a>
        {% endif %}
      </div>
    </div>

    <!-- Tabel Buku -->
    <div class="bg-white shadow-md rounded-lg overflow-hidden">
      <table class="min-w-full leading-normal">
        <thead>
          <tr
            class="border-b-2 border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
          >
            <th class="px-5 py-3">Judul</th>
            <th class="px-5 py-3">Penulis</th>
            <th class="px-5 py-3">Tahun</th>
            <th class="px-5 py-3">Aksi</th>
          </tr>
        </thead>
        <tbody>
          {% for book in books %}
          <tr class="border-b border-gray-200 hover:bg-gray-50">
            <td class="px-5 py-4 text-sm">
              <p class="text-gray-900 whitespace-no-wrap">{{ book.judul }}</p>
            </td>
            <td class="px-5 py-4 text-sm">
              <p class="text-gray-900 whitespace-no-wrap">{{ book.penulis }}</p>
            </td>
            <td class="px-5 py-4 text-sm">
              <p class="text-gray-900 whitespace-no-wrap">
                {{ book.tahun_terbit }}
              </p>
            </td>
            <td class="px-5 py-4 text-sm flex gap-4">
              <a
                href="{{ url_for('edit_buku', buku_id=book.id) }}"
                class="text-yellow-600 hover:text-yellow-900 font-medium"
                >Edit</a
              >
              <form
                action="{{ url_for('hapus_buku', buku_id=book.id) }}"
                method="POST"
                onsubmit="return confirm('Apakah Anda yakin ingin menghapus buku ini?');"
              >
                <input
                  type="hidden"
                  name="csrf_token"
                  value="{{ csrf_token() }}"
                />
                <button
                  type="submit"
                  class="text-red-600 hover:text-red-900 font-medium bg-transparent border-none p-0 cursor-pointer"
                >
                  Hapus
                </button>
              </form>
              {# Nanti ke url_for('hapus_buku', book_id=book.id) #}
            </td>
          </tr>
          <!-- Akhir Baris Data -->
          {% endfor %}
        </tbody>
      </table>
    </div>
  </main>
</div>
{% endblock %}
